name: Deploy LINE Rich Menu (Alias Switch A/B)

on:
  workflow_dispatch: {}          # 手動觸發
  push:                          # 自動觸發
    branches: [main]             # 只在 main 分支
    paths:                       # 指定哪些檔案變更才觸發
      - 'syh/line/menuA.png'
      - 'syh/line/menuB.png'
      - 'syh/deploy_richmenu_alias.py'
      - 'requirements.txt'
      - '.github/workflows/deploy-richmenu-alias.yml'

jobs:
  deploy:
    runs-on: ubuntu-latest
    concurrency:
      group: richmenu-alias
      cancel-in-progress: true
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install deps
        run: |
          pip install -r requirements.txt

      - name: Deploy two-page rich menu (A/B)
        env:
          LINE_TOKEN: ${{ secrets.LINE_TOKEN }}
        run: |
          ls -al syh/line || true
          python syh/deploy_richmenu_alias.py \
            --imageA syh/line/menuA.png \
            --imageB syh/line/menuB.png \
            --set-default menu-a \
            --delete-others
